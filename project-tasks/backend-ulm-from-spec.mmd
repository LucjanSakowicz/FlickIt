flowchart TD
  %% USER
  U1(["POST /users (UserDto)"]) --> U2(["Rejestracja: walidacja, zapis w DB"])
  U2 --> U3(["User (id, phone, roles, ratingAvg?, ratingCount?)"])
  U4(["POST /auth/login (phone, hasło)"]) --> U5(["Logowanie: weryfikacja, JWT"])
  U5 --> U6(["JWT token"])
  U7(["GET /users/me"]) --> U8(["JWT: pobranie userId"])
  U8 --> U9(["UserDto"])

  %% EVENT
  E1(["POST /events (CreateEventRequest)"]) --> E2(["Walidacja, AI, zapis Event"])
  E2 --> E3(["Event (id, status, ...)"])
  E2 --> E4(["EventImage (id, eventId, url, idx, isAiSource?)"])
  E2 --> E5(["EventVisionLabel (eventImageId, label, confidence)"])
  E2 --> E6(["EventCompliance (eventId, category, expiryDate?)"])
  E2 --> N2(["Push: powiadomienia do subskrybentów"])
  E7(["GET /events/latest?geo=…"]) --> E8(["Pobranie eventów po geo, statusie"])
  E8 --> E3
  E9(["PUT /events/{id}"]) --> E10(["Aktualizacja eventu, walidacja uprawnień"])
  E10 --> E3
  E11(["DELETE /events/{id}"]) --> E12(["Status REMOVED"])
  E12 --> E3

  %% CLAIM
  C1(["PUT /events/{id}/claim (ClaimEventRequest)"]) --> C2(["Walidacja, zapis Claim"])
  C2 --> C3(["Claim (eventId, userId, createdAt, ...)"])

  %% RATING
  R1(["POST /rate (RateEventRequest)"]) --> R2(["Walidacja geo-fence, rating, zapis do Claim"])
  R2 --> C3

  %% NOTIFICATION
  N1(["POST /notifications/subscribe (NotificationSubscription)"]) --> N2(["Zapis tokenu, radius"])
  N2 --> N3(["NotificationSubscription (token, userId, radius)"])

  %% AI
  A1(["AI: generowanie tytułu/opisu (VisionLabelDto)"]) --> E2

  %% SECURITY
  S1(["Security: JWT, role, CORS"])
  S1 --> U5
  S1 --> U8
  S1 --> E2
  S1 --> E10
  S1 --> E12
  S1 --> C2
  S1 --> R2
  S1 --> N2 